(()=>{"use strict";class e{constructor(e,t,s){this._cardData=e,this._link=e.link,this._name=e.title,this._selectorTemplate=t,this._clickImage=s}_templateClone(){return document.querySelector(this._selectorTemplate).content.querySelector(".element").cloneNode(!0)}_cardLike=()=>{this._buttonLike.classList.toggle("element__button-like_active")};_cardDelete=()=>{this._cloneElement.remove(),this._cloneElement=null};_cardImage=()=>{this._clickImage(this._cardData)};_setEventListeners(){this._buttonLike.addEventListener("click",this._cardLike),this._buttonDelete.addEventListener("click",this._cardDelete),this._elementImg.addEventListener("click",this._cardImage)}createCard(){return this._cloneElement=this._templateClone(),this._elementImg=this._cloneElement.querySelector(".element__img"),this._buttonLike=this._cloneElement.querySelector(".element__button-like"),this._buttonDelete=this._cloneElement.querySelector(".element__button-delete"),this._subTitle=this._cloneElement.querySelector(".element__text"),this._elementImg.src=this._link,this._elementImg.alt=this._name,this._subTitle.textContent=this._name,this._setEventListeners(),this._cloneElement}}class t{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._activeButtonClass=e.activeButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t,this._button=this._form.querySelector(this._submitButtonSelector),this._cardElements=this._form.querySelectorAll(this._inputSelector)}_showInputError(e,t){t.classList.add(this._inputErrorClass),e.classList.add(this._errorClass),e.textContent=t.validationMessage}_hideInputError(e,t){t.classList.remove(this._inputErrorClass),e.classList.remove(this._errorClass),e.textContent=""}_enableButton(){this._button.classList.remove(this._inactiveButtonClass),this._button.classList.add(this._activeButtonClass),this._button.removeAttribute("disabled")}disableButton(){this._button.classList.add(this._inactiveButtonClass),this._button.classList.remove(this._activeButtonClass),this._button.setAttribute("disabled",!0)}_invalidInput(){return Array.from(this._cardElements).every((e=>e.validity.valid))}_toggleButton(){this._invalidInput()?this._enableButton():this.disableButton(this._button)}_checkInputValidity(e){const t=this._form.querySelector(`#${e.id}-error`);e.validity.valid?this._hideInputError(t,e):this._showInputError(t,e)}_setEventListeners(){this._cardElements.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButton()}))}))}enableValidation(){this._setEventListeners()}removeValidationErrors(){this._cardElements.forEach((e=>{const t=this._form.querySelector(`#${e.id}-error`);e.validity.valid||this._hideInputError(t,e)})),this.disableButton()}}class s{constructor(e){this._popup=document.querySelector(e),this._popupCloseOnButton=this._popup.querySelector(".popup__close")}_сlosePopupProfileOnEsc=e=>{"Escape"===e.key&&this.closePopup()};_popupCloseOnX=e=>{this.closePopup()};_closePopupOnOverlay=e=>{e.target===e.currentTarget&&this.closePopup()};setEventListeners(){this._popupCloseOnButton.addEventListener("mousedown",this._popupCloseOnX),this._popup.addEventListener("mousedown",this._closePopupOnOverlay)}openPopup(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._сlosePopupProfileOnEsc)}closePopup(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._сlosePopupProfileOnEsc)}}class i extends s{constructor(e,t){super(e),this._submitData=t,this._form=this._popup.querySelector(".popup__form"),this._inputs=this._form.querySelectorAll(".popup__input")}_getInputValues(){return this._values={},this._inputs.forEach((e=>{this._values[e.name]=e.value})),this._values}setInputsValue(e){this._inputs.forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submitData(this._getInputValues())}))}closeForm(){super.closePopup(),this._form.reset()}}const o=document.querySelector(".profile__edit"),r=document.querySelector(".profile__add-card"),n=document.forms["form-edit"],l=document.forms["form-add"],a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save",inactiveButtonClass:"popup__save_disabled",activeButtonClass:"popup__save_enabled",inputErrorClass:"popup__input_errored",errorClass:"popup__error_visible"},p=new t(a,n);p.enableValidation();const u=new t(a,l);u.enableValidation();const c=new class{constructor(e){this._editName=document.querySelector(e.editNameSelector),this._editJob=document.querySelector(e.editJobSelector)}getUserInfo(){return{name:this._editName.textContent,occupation:this._editJob.textContent}}setUserInfo(e){this._editName.textContent=e.name,this._editJob.textContent=e.occupation}}({editNameSelector:".profile__title",editJobSelector:".profile__text"}),_=new class extends s{constructor(e){super(e),this._popupImage=this._popup.querySelector(".popup__image"),this._imageCaption=this._popup.querySelector(".popup__caption")}openPopup=e=>{this._popupImage.src=e.link,this._popupImage.alt=e.title,this._imageCaption.textContent=e.name,console.log(this._popupImage.src),super.openPopup()}}(".popup-images"),d=new i(".popup_edit",(e=>{c.setUserInfo(e),d.closeForm()})),h=new i(".popup_add_card",(e=>{m.addItem(e),h.closeForm()})),m=new class{constructor(e,t){let{items:s,renderer:i}=e;this._container=document.querySelector(t),this._initialCards=s,this._renderer=i}getArrayCards(){this._initialCards.forEach((e=>{this.addItem(e)}))}addItem(e){this._container.prepend(this._renderer(e))}}({items:[{title:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{title:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{title:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{title:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{title:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{title:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:t=>new e(t,"#idTemplate",_.openPopup).createCard()},".elements");m.getArrayCards(),_.setEventListeners(),d.setEventListeners(),h.setEventListeners(),o.addEventListener("click",(()=>{p.removeValidationErrors(),d.setInputsValue(c.getUserInfo()),d.openPopup()})),r.addEventListener("click",(()=>{u.removeValidationErrors(),h.openPopup()}))})();