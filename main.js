(()=>{"use strict";class t{constructor(t,e,s,i,o){this._cardData=t,this._idDeveloper=t.idDeveloper,this._idUser=t.owner._id,this._idCard=t._id,this._likes=t.likes,this._likesLength=t.likes.length,this._link=t.link,this._name=t.name,this._selectorTemplate=e,this._clickImage=s,this._openDeleteCardPopup=i,this._increaseQuantityLiked=o}_templateClone(){return document.querySelector(this._selectorTemplate).content.querySelector(".element").cloneNode(!0)}_cardLike=()=>{this._increaseQuantityLiked(this._buttonLike,this._idCard)};_cardDelete=()=>{this._openDeleteCardPopup({card:this,idCard:this._idCard})};_cardImage=()=>{this._clickImage(this._cardData)};_setEventListeners(){this._buttonLike.addEventListener("click",this._cardLike),this._buttonDelete.addEventListener("click",this._cardDelete),this._elementImg.addEventListener("click",this._cardImage)}_defineWhoseId(){this._idDeveloper===this._idUser?this._buttonDelete.style.display="block":this._buttonDelete.style.display="none"}_defineWhoseLikes(){this._likes.forEach((t=>{t._id!==this._idDeveloper||this._buttonLike.classList.add("element__button-like_active")})),this._counter.textContent=this._likesLength}toggleLikeIkon(t){this._buttonLike.classList.toggle("element__button-like_active"),this._counter.textContent=t.length}removeCardItem(){this._cloneElement.remove(),this._cloneElement=null}createCard(){return this._cloneElement=this._templateClone(),this._elementImg=this._cloneElement.querySelector(".element__img"),this._buttonLike=this._cloneElement.querySelector(".element__button-like"),this._buttonDelete=this._cloneElement.querySelector(".element__button-delete"),this._subTitle=this._cloneElement.querySelector(".element__text"),this._counter=this._cloneElement.querySelector(".elements__counter"),this._elementImg.src=this._link,this._elementImg.alt=this._name,this._subTitle.textContent=this._name,this._defineWhoseLikes(),this._defineWhoseId(),this._setEventListeners(),this._cloneElement}}class e{constructor(t,e){this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._activeButtonClass=t.activeButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._form=e,this._button=this._form.querySelector(this._submitButtonSelector),this._cardElements=this._form.querySelectorAll(this._inputSelector)}_showInputError(t,e){e.classList.add(this._inputErrorClass),t.classList.add(this._errorClass),t.textContent=e.validationMessage}_hideInputError(t,e){e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_enableButton(){this._button.classList.remove(this._inactiveButtonClass),this._button.classList.add(this._activeButtonClass),this._button.removeAttribute("disabled")}disableButton(){this._button.classList.add(this._inactiveButtonClass),this._button.classList.remove(this._activeButtonClass),this._button.setAttribute("disabled",!0)}_invalidInput(){return Array.from(this._cardElements).every((t=>t.validity.valid))}_toggleButton(){this._invalidInput()?this._enableButton():this.disableButton(this._button)}_checkInputValidity(t){const e=this._form.querySelector(`#${t.id}-error`);t.validity.valid?this._hideInputError(e,t):this._showInputError(e,t)}_setEventListeners(){this._cardElements.forEach((t=>{t.addEventListener("input",(()=>{this._checkInputValidity(t),this._toggleButton()}))}))}enableValidation(){this._setEventListeners()}removeValidationErrors(){this._cardElements.forEach((t=>{const e=this._form.querySelector(`#${t.id}-error`);t.validity.valid||this._hideInputError(e,t)})),this.disableButton()}}class s{constructor(t){this._popup=document.querySelector(t),this._popupCloseOnButton=this._popup.querySelector(".popup__close")}_сlosePopupProfileOnEsc=t=>{"Escape"===t.key&&this.closePopup()};_popupCloseOnX=t=>{this.closePopup()};_closePopupOnOverlay=t=>{t.target===t.currentTarget&&this.closePopup()};setEventListeners(){this._popupCloseOnButton.addEventListener("mousedown",this._popupCloseOnX),this._popup.addEventListener("mousedown",this._closePopupOnOverlay)}openPopup(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._сlosePopupProfileOnEsc)}closePopup(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._сlosePopupProfileOnEsc)}}class i extends s{constructor(t,e){super(t),this._submitData=e,this._form=this._popup.querySelector(".popup__form"),this._inputs=this._form.querySelectorAll(".popup__input"),this._submitButton=this._form.querySelectorAll(".popup__save"),this._textSubmitButton=this._submitButton.textContent}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(t=>{t.preventDefault(),this._submitButton.textContent=`${this._submitButton.textContent} ...`,this._submitData(this._getInputValues())}))}_getInputValues(){return this._values={},this._inputs.forEach((t=>{this._values[t.name]=t.value})),this._values}setInputsValue(t){this._inputs.forEach((e=>{e.value=t[e.name]}))}resetTextSubmitButton(){this._submitButton.textContent=this._textSubmitButton}closeForm(){super.closePopup(),this._form.reset()}}const o=document.querySelector(".profile__edit"),r=document.querySelector(".profile__add-card"),n=document.querySelector(".profile__avatar-button"),a=document.forms["form-edit"],u=document.forms["form-add"],l=document.forms["form-avatar"],h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save",inactiveButtonClass:"popup__save_disabled",activeButtonClass:"popup__save_enabled",inputErrorClass:"popup__input_errored",errorClass:"popup__error_visible"},_=new e(h,a);_.enableValidation();const c=new e(h,u);c.enableValidation();const p=new e(h,l);p.enableValidation();const d=new class{constructor(t){this._editName=document.querySelector(t.editNameSelector),this._editJob=document.querySelector(t.editJobSelector),this._editAvatar=document.querySelector(t.editAvatarSelector)}getUserInfo(){return{name:this._editName.textContent,occupation:this._editJob.textContent}}setUserInfo(t){let{avatar:e,name:s,occupation:i}=t;this._editAvatar.src=e,this._editName.textContent=s,this._editJob.textContent=i}}({editNameSelector:".profile__title",editJobSelector:".profile__text",editAvatarSelector:".profile__avatar"}),m=new class extends s{constructor(t){super(t),this._popupImage=this._popup.querySelector(".popup__image"),this._imageCaption=this._popup.querySelector(".popup__caption")}openPopup=t=>{this._popupImage.src=t.link,this._popupImage.alt=t.title,this._imageCaption.textContent=t.name,console.log(this._popupImage.src),super.openPopup()}}(".popup-images"),v=new class{constructor(t){this._url=t.baseUrl,this._headers=t.headers,this._authorization=t.headers.authorization}_verification(t){return t.ok?t.json():Promise.reject}getInfo(){return fetch(`${this._url}/users/me`,{headers:{authorization:this._authorization}}).then(this._verification)}getCards(){return fetch(`${this._url}/cards`,{headers:{authorization:this._authorization}}).then(this._verification)}setUserInfo(t){return fetch(`${this._url}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t.name,about:t.occupation})}).then(this._verification)}setUserAvatar(t){return fetch(`${this._url}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t.avatar})}).then(this._verification)}addCard(t){return fetch(`${this._url}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t.title,link:t.link})}).then(this._verification)}addLike(t){return fetch(`${this._url}/cards/${t}/likes`,{method:"PUT",headers:{authorization:this._authorization}}).then(this._verification)}deleteLike(t){return fetch(`${this._url}/cards/${t}/likes`,{method:"DELETE",headers:{authorization:this._authorization}}).then(this._verification)}deletecard(t){return fetch(`${this._url}/cards/${t}`,{method:"DELETE",headers:{authorization:this._authorization}}).then(this._verification)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-66",headers:{authorization:"e953470f-7b3a-4696-9a09-3ba0a29b5fee","Content-Type":"application/json"}}),b=new i(".popup-edit",(t=>{v.setUserInfo(t).then((t=>{d.setUserInfo({name:t.name,occupation:t.about,avatar:t.avatar}),b.closeForm()})).catch((t=>console.error(`Ошибка при редактировании профиля ${t}`))).finally((()=>b.resetTextSubmitButton()))})),f=new i(".popup-avatar",(t=>{v.setUserAvatar(t).then((t=>{d.setUserInfo({name:t.name,occupation:t.about,avatar:t.avatar}),f.closeForm()})).catch((t=>console.error(`Ошибка при изменении аватара ${t}`))).finally((()=>f.resetTextSubmitButton()))})),E=new i(".popup-add-card",(t=>{Promise.all([v.getInfo(),v.addCard(t)]).then((t=>{let[e,s]=t;s.idDeveloper=e._id,y.addItem(L(s)),E.closeForm()})).catch((t=>console.error(`Ошибка добавления карточки ${t}`))).finally((()=>E.resetTextSubmitButton()))})),C=new class extends s{constructor(t,e){super(t),this._submitFunction=e,this._form=this._popup.querySelector(".popup__form"),this._submitButton=this._form.querySelector(".popup__save"),this._textSubmitButton=this._submitButton.textContent}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(t=>{t.preventDefault(),this._submitButton.textContent=`${this._submitButton.textContent}...`,this._submitFunction({card:this._element,idCard:this._idCard})}))}resetTextSubmitButton(){this._submitButton.textContent=this._textSubmitButton}openPopup=(t,e)=>{super.openPopup(),this._element=t,this._idCard=e}}(".popup-delete-card",(t=>{let{card:e,idCard:s}=t;v.deletecard(s).then((t=>{e.removeCardItem(),C.closeForm()})).catch((t=>console.error(`Ошибка удаления карточки ${t}`))).finally((()=>C.resetTextSubmitButton()))})),L=e=>{const s=new t(e,"#idTemplate",m.openPopup,C.openPopup,((t,e)=>{t.classList.contains(".element__button-like_active")?v.deleteLike(e).then((t=>{s.toggleLikeIkon(t.likes)})).catch((t=>console.error(`Ошибка снятия лайка ${t}`))):v.addLike(e).then((t=>{s.toggleLikeIkon(t.likes)})).catch((t=>console.error(`Ошибка добавления лайка ${t}`)))}));return s.createCard()},y=new class{constructor(t,e){this._container=document.querySelector(e),this._renderer=t}getArrayCards(t){t.forEach((t=>{this._renderer(t)}))}addItem(t){this._container.prepend(t)}}((t=>{y.addItem(L(t))}),".elements");Promise.all([v.getInfo(),v.getCards()]).then((t=>{let[e,s]=t;s.forEach((t=>t.idDeveloper=e._id)),d.setUserInfo({name:e.name,occupation:e.about,avatar:e.avatar}),y.getArrayCards(s)})).catch((t=>console.error(`Ошибка при создании начальных данных страницы ${t}`))),m.setEventListeners(),b.setEventListeners(),E.setEventListeners(),f.setEventListeners(),o.addEventListener("click",(()=>{_.removeValidationErrors(),b.setInputsValue(d.getUserInfo()),b.openPopup()})),n.addEventListener("click",(()=>{p.removeValidationErrors(),f.setInputsValue(d.getUserInfo()),f.openPopup()})),r.addEventListener("click",(()=>{c.removeValidationErrors(),E.openPopup()}))})();